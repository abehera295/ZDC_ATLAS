#include "Tool.h"

static double effd_PbPb[][24]={
	{0.490,0.575,0.625,0.675,0.725,0.775,0.825,0.875,0.925,0.975,1.250,1.500,1.750,2.000,2.500,3.000,3.500,4.000,5.000,6.000,8.000,10.00,15.00,21.00},
	{0.554,0.685,0.704,0.717,0.726,0.732,0.732,0.735,0.731,0.737,0.739,0.742,0.744,0.747,0.751,0.754,0.757,0.760,0.764,0.767,0.770,0.771,0.770,0.767},
	{0.577,0.716,0.732,0.742,0.744,0.747,0.746,0.746,0.750,0.748,0.756,0.759,0.762,0.765,0.771,0.776,0.781,0.785,0.791,0.797,0.804,0.808,0.813,0.813},
	{0.393,0.503,0.521,0.532,0.544,0.557,0.566,0.576,0.586,0.595,0.627,0.646,0.661,0.672,0.687,0.696,0.701,0.704,0.706,0.708,0.709,0.710,0.713,0.717},
	{0.280,0.403,0.429,0.448,0.465,0.480,0.493,0.504,0.513,0.521,0.552,0.569,0.580,0.588,0.596,0.600,0.602,0.603,0.605,0.606,0.609,0.611,0.617,0.624},
	{0.259,0.384,0.415,0.433,0.449,0.458,0.471,0.479,0.485,0.493,0.515,0.527,0.534,0.539,0.544,0.547,0.548,0.549,0.551,0.553,0.558,0.563,0.576,0.590},
	{0.564,0.697,0.715,0.724,0.732,0.737,0.740,0.737,0.741,0.737,0.739,0.742,0.744,0.747,0.752,0.756,0.759,0.762,0.767,0.770,0.775,0.776,0.776,0.773},
	{0.590,0.728,0.743,0.751,0.751,0.750,0.752,0.751,0.750,0.753,0.757,0.760,0.763,0.766,0.772,0.777,0.781,0.785,0.792,0.798,0.806,0.812,0.817,0.818},
	{0.418,0.534,0.551,0.563,0.575,0.585,0.592,0.603,0.613,0.618,0.644,0.658,0.669,0.678,0.692,0.701,0.707,0.711,0.716,0.719,0.722,0.724,0.728,0.733},
	{0.309,0.438,0.464,0.482,0.497,0.510,0.523,0.534,0.545,0.551,0.574,0.585,0.594,0.599,0.606,0.609,0.611,0.612,0.614,0.615,0.618,0.621,0.626,0.633},
	{0.281,0.415,0.449,0.464,0.476,0.486,0.499,0.504,0.509,0.513,0.528,0.537,0.543,0.547,0.552,0.554,0.556,0.557,0.559,0.562,0.568,0.574,0.591,0.612},
	{0.572,0.706,0.719,0.730,0.735,0.738,0.739,0.740,0.738,0.736,0.739,0.742,0.745,0.747,0.752,0.756,0.759,0.762,0.767,0.771,0.775,0.777,0.778,0.774},
	{0.596,0.735,0.747,0.754,0.754,0.755,0.752,0.753,0.754,0.754,0.757,0.760,0.763,0.766,0.771,0.776,0.781,0.785,0.792,0.798,0.806,0.812,0.818,0.819},
	{0.437,0.563,0.576,0.589,0.598,0.606,0.616,0.623,0.631,0.640,0.657,0.667,0.675,0.682,0.694,0.703,0.710,0.715,0.723,0.727,0.732,0.734,0.737,0.739},
	{0.329,0.467,0.493,0.511,0.523,0.535,0.545,0.553,0.563,0.568,0.588,0.597,0.604,0.609,0.615,0.618,0.620,0.621,0.622,0.624,0.627,0.629,0.635,0.642},
	{0.298,0.440,0.474,0.490,0.498,0.509,0.513,0.517,0.525,0.530,0.539,0.544,0.548,0.552,0.558,0.562,0.566,0.569,0.572,0.575,0.580,0.584,0.594,0.608},
	{0.574,0.706,0.719,0.728,0.734,0.743,0.738,0.735,0.731,0.735,0.736,0.740,0.744,0.747,0.752,0.757,0.761,0.764,0.769,0.773,0.776,0.778,0.776,0.773},
	{0.600,0.741,0.750,0.755,0.752,0.754,0.751,0.754,0.752,0.757,0.756,0.760,0.764,0.768,0.774,0.780,0.785,0.790,0.798,0.804,0.811,0.816,0.820,0.819},
	{0.461,0.592,0.607,0.616,0.626,0.633,0.638,0.643,0.649,0.651,0.670,0.677,0.683,0.687,0.696,0.703,0.711,0.717,0.727,0.734,0.743,0.748,0.752,0.753},
	{0.351,0.497,0.522,0.541,0.550,0.561,0.568,0.577,0.583,0.590,0.600,0.605,0.610,0.614,0.622,0.628,0.633,0.637,0.643,0.647,0.652,0.654,0.655,0.654},
	{0.313,0.467,0.499,0.514,0.519,0.527,0.530,0.534,0.541,0.543,0.550,0.553,0.555,0.557,0.561,0.565,0.568,0.571,0.578,0.583,0.593,0.600,0.614,0.622},
	{0.569,0.705,0.720,0.729,0.733,0.735,0.734,0.737,0.737,0.733,0.736,0.740,0.743,0.746,0.751,0.756,0.760,0.763,0.768,0.771,0.774,0.775,0.774,0.771},
	{0.604,0.741,0.748,0.754,0.755,0.757,0.749,0.757,0.754,0.750,0.757,0.761,0.765,0.769,0.776,0.781,0.787,0.791,0.798,0.804,0.811,0.816,0.819,0.818},
	{0.481,0.617,0.626,0.635,0.642,0.647,0.653,0.654,0.657,0.657,0.672,0.678,0.683,0.688,0.697,0.705,0.712,0.717,0.727,0.734,0.744,0.749,0.754,0.755},
	{0.368,0.522,0.549,0.561,0.567,0.581,0.589,0.591,0.595,0.604,0.609,0.612,0.615,0.617,0.622,0.627,0.631,0.635,0.641,0.646,0.654,0.659,0.664,0.666},
	{0.323,0.483,0.514,0.523,0.531,0.535,0.539,0.545,0.543,0.539,0.552,0.556,0.559,0.562,0.568,0.573,0.578,0.582,0.590,0.596,0.604,0.610,0.618,0.625},
	{0.572,0.703,0.720,0.725,0.730,0.733,0.734,0.738,0.738,0.726,0.734,0.739,0.743,0.747,0.754,0.759,0.763,0.767,0.772,0.775,0.777,0.778,0.776,0.772},
	{0.599,0.740,0.749,0.754,0.757,0.754,0.752,0.747,0.750,0.756,0.756,0.761,0.765,0.769,0.777,0.783,0.788,0.793,0.800,0.805,0.812,0.815,0.817,0.817},
	{0.494,0.633,0.645,0.648,0.654,0.657,0.657,0.659,0.665,0.665,0.677,0.682,0.687,0.692,0.700,0.707,0.714,0.719,0.728,0.735,0.743,0.748,0.752,0.753},
	{0.380,0.545,0.567,0.576,0.583,0.590,0.597,0.602,0.606,0.600,0.612,0.616,0.620,0.623,0.630,0.635,0.640,0.644,0.650,0.654,0.660,0.662,0.665,0.666},
	{0.329,0.490,0.523,0.531,0.540,0.540,0.547,0.547,0.544,0.555,0.556,0.560,0.563,0.567,0.574,0.580,0.585,0.591,0.600,0.608,0.620,0.628,0.639,0.644},
	{0.573,0.702,0.718,0.721,0.733,0.739,0.727,0.735,0.733,0.731,0.736,0.742,0.746,0.751,0.757,0.763,0.767,0.769,0.773,0.775,0.776,0.776,0.774,0.771},
	{0.601,0.740,0.754,0.756,0.753,0.754,0.754,0.751,0.752,0.753,0.757,0.762,0.767,0.772,0.780,0.787,0.792,0.797,0.804,0.809,0.815,0.817,0.818,0.817},
	{0.501,0.645,0.654,0.658,0.660,0.660,0.668,0.666,0.667,0.674,0.680,0.686,0.692,0.698,0.708,0.716,0.722,0.728,0.736,0.742,0.748,0.751,0.752,0.753},
	{0.390,0.551,0.576,0.587,0.588,0.597,0.606,0.606,0.605,0.610,0.619,0.622,0.625,0.627,0.632,0.637,0.641,0.645,0.651,0.656,0.664,0.668,0.672,0.673},
	{0.331,0.492,0.530,0.536,0.544,0.546,0.550,0.551,0.561,0.555,0.558,0.561,0.565,0.569,0.575,0.581,0.587,0.593,0.602,0.610,0.623,0.633,0.646,0.652},
	{0.573,0.701,0.711,0.719,0.729,0.731,0.729,0.732,0.729,0.733,0.741,0.746,0.750,0.754,0.760,0.764,0.768,0.770,0.773,0.775,0.776,0.775,0.773,0.770},
	{0.601,0.740,0.747,0.759,0.753,0.754,0.757,0.753,0.749,0.753,0.760,0.767,0.773,0.778,0.787,0.794,0.800,0.804,0.809,0.812,0.815,0.816,0.816,0.814},
	{0.511,0.649,0.658,0.659,0.664,0.669,0.662,0.671,0.669,0.672,0.682,0.689,0.695,0.701,0.711,0.720,0.726,0.732,0.740,0.746,0.752,0.755,0.756,0.756},
	{0.395,0.562,0.582,0.595,0.599,0.597,0.604,0.615,0.604,0.615,0.621,0.626,0.631,0.636,0.643,0.649,0.655,0.659,0.666,0.670,0.675,0.677,0.678,0.679},
	{0.332,0.498,0.533,0.534,0.541,0.550,0.544,0.549,0.544,0.550,0.560,0.566,0.571,0.575,0.584,0.592,0.598,0.604,0.613,0.620,0.629,0.634,0.640,0.643},
	{0.573,0.700,0.714,0.727,0.731,0.736,0.741,0.734,0.736,0.731,0.745,0.751,0.755,0.759,0.765,0.769,0.771,0.773,0.775,0.776,0.775,0.775,0.772,0.770},
	{0.601,0.739,0.757,0.758,0.761,0.761,0.763,0.758,0.751,0.760,0.766,0.773,0.779,0.784,0.792,0.799,0.803,0.807,0.811,0.813,0.816,0.816,0.816,0.815},
	{0.511,0.653,0.661,0.664,0.668,0.669,0.675,0.672,0.671,0.677,0.692,0.699,0.706,0.711,0.721,0.728,0.734,0.738,0.744,0.748,0.752,0.753,0.754,0.755},
	{0.395,0.563,0.588,0.596,0.599,0.590,0.608,0.611,0.616,0.619,0.627,0.632,0.637,0.641,0.648,0.653,0.657,0.660,0.665,0.667,0.670,0.671,0.672,0.672},
	{0.327,0.492,0.531,0.543,0.549,0.548,0.545,0.565,0.560,0.558,0.565,0.572,0.578,0.584,0.594,0.603,0.609,0.615,0.623,0.629,0.635,0.638,0.641,0.643},
	{0.575,0.704,0.715,0.722,0.743,0.743,0.748,0.745,0.733,0.742,0.748,0.754,0.759,0.763,0.769,0.773,0.776,0.778,0.780,0.780,0.780,0.779,0.776,0.773},
	{0.597,0.741,0.758,0.758,0.766,0.760,0.759,0.757,0.763,0.763,0.770,0.777,0.784,0.789,0.798,0.804,0.808,0.811,0.814,0.816,0.817,0.817,0.816,0.815},
	{0.518,0.656,0.665,0.667,0.670,0.680,0.677,0.679,0.683,0.679,0.698,0.707,0.713,0.718,0.727,0.733,0.739,0.743,0.748,0.751,0.753,0.754,0.754,0.755},
	{0.403,0.570,0.588,0.597,0.607,0.605,0.603,0.616,0.621,0.620,0.635,0.642,0.648,0.653,0.661,0.666,0.669,0.672,0.674,0.675,0.676,0.676,0.677,0.677},
	{0.336,0.503,0.533,0.546,0.550,0.559,0.556,0.565,0.558,0.553,0.574,0.580,0.585,0.590,0.599,0.607,0.613,0.619,0.627,0.633,0.641,0.645,0.649,0.652},
};

Tool::Tool()
{
	char name[200];
	TFile* fTrkEffScale = new TFile("Tools/NewScales.root","READ");
	for(int iC=0; iC<20; iC++)
	{
		for(int iE=0; iE<5; iE++)
		{
			sprintf(name,"gr_spec_ratio_cent%d_eta%d_cut1",iC,iE);
			gTrkEffScale[iC][iE]=(TGraphErrors*)fTrkEffScale->Get(name);
		}
	}

	for(int iC=0; iC<10; iC++)
	{
		for(int iE=0; iE<5; iE++)
		{
			gTrkEff[iC][iE] = new TGraph(24,effd_PbPb[0],effd_PbPb[iE+5*iC+1]);
			sprintf(name,"gr_eff_PbPb_cent%d_eta%d",iC,iE);
			gTrkEff[iC][iE]->SetName(name);
		}
	}
	
}

Tool::~Tool()
{
}

double Tool::detTrkEff(double cent, double eta, double pt)
{
	int etaBin = -1;
	if		 (fabs(eta)<0.35) etaBin = 0;
	else if(fabs(eta)<0.80) etaBin = 1;
	else if(fabs(eta)<1.50) etaBin = 2;
	else if(fabs(eta)<2.00) etaBin = 3;
	else etaBin = 4;

	int centBin = -1;
	if     (cent>79.9) centBin = 9; 
	else if(cent>69.9) centBin = 8; 
	else if(cent>59.9) centBin = 7; 
	else if(cent>49.9) centBin = 6; 
	else if(cent>39.9) centBin = 5; 
	else if(cent>29.9) centBin = 4; 
	else if(cent>19.9) centBin = 3; 
	else if(cent> 9.9) centBin = 2; 
	else if(cent> 4.9) centBin = 1;
	else centBin = 0;

	double eff = 1;
	eff = gTrkEff[centBin][etaBin]->Eval(pt)*gTrkEffScale[int(cent/5.)][etaBin]->Eval(pt);
	
	return 1./eff;
}
